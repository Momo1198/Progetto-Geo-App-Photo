{% extends "base.html" %}

{% block title %}GeoPhoto Enhanced - Extract GPS from Photos{% endblock %}

{% block content %}
<div class="container">
    <header class="header">
        <h1 class="title">
            <i class="fas fa-map-marker-alt">üìç</i>
            GeoPhoto Enhanced
        </h1>
        <p class="description">Professional GPS extraction with complete EXIF metadata analysis</p>
    </header>

    <main class="main-content">
        <!-- Upload Section -->
        <section class="upload-section">
            <form id="upload-form" action="/" method="post" enctype="multipart/form-data" class="upload-form">
                <div class="file-input-container">
                    <input type="file" name="photo" id="photo" accept="image/*" required>
                    <label for="photo" class="file-input-label">
                        <i class="fas fa-cloud-upload-alt">üì∑</i>
                        <span class="file-text">Choose a photo...</span>
                    </label>
                </div>
                
                <div id="file-info" class="file-info"></div>
                
                <button type="submit" class="submit-btn">
                    <i class="fas fa-search">üîç</i>
                    Extract GPS & EXIF Data
                </button>
            </form>
        </section>

        <!-- Results Section -->
        <section class="results-section">
            {% if error %}
            <div class="result error">
                <h2 class="result-title">
                    <i class="fas fa-exclamation-triangle">‚ö†Ô∏è</i>
                    Error
                </h2>
                <p class="error-message">{{ error }}</p>
                <div class="error-help">
                    <h3>Why might this happen?</h3>
                    <ul>
                        <li>The photo doesn't contain GPS location data</li>
                        <li>The GPS data was removed during editing or transfer</li>
                        <li>The photo format doesn't support EXIF metadata</li>
                        <li>The GPS data is corrupted or incomplete</li>
                    </ul>
                </div>
            </div>
            {% endif %}

            {% if success %}
            <!-- GPS Results Section -->
            <div class="result {% if has_gps %}success{% else %}warning{% endif %}">
                <h2 class="result-title">
                    {% if has_gps %}
                        <i class="fas fa-check-circle">‚úÖ</i>
                        Location Found
                    {% else %}
                        <i class="fas fa-info-circle">‚ÑπÔ∏è</i>
                        No GPS Data Found
                    {% endif %}
                </h2>
                
                {% if has_gps %}
                <div class="location-details">
                    <p><strong>File:</strong> {{ filename }}</p>
                    <p><strong>Latitude:</strong> <span class="coordinates" id="current-lat">{{ latitude }}</span></p>
                    <p><strong>Longitude:</strong> <span class="coordinates" id="current-lon">{{ longitude }}</span></p>
                </div>
                
                <div class="map-actions">
                    <a href="{{ map_link }}" target="_blank" rel="noopener noreferrer" class="map-link">
                        <i class="fas fa-external-link-alt">üó∫Ô∏è</i>
                        View on Google Maps
                    </a>
                    <button class="copy-btn" data-clipboard-text="{{ latitude }}, {{ longitude }}">
                        <i class="fas fa-copy">üìã</i>
                        Copy Coordinates
                    </button>
                    <button class="edit-gps-btn" data-lat="{{ latitude }}" data-lon="{{ longitude }}">
                        <i class="fas fa-edit">‚úèÔ∏è</i>
                        Edit Coordinates
                    </button>
                </div>
                {% else %}
                <div class="no-gps-info">
                    <p>This photo does not contain GPS coordinates.</p>
                    <button class="add-gps-btn" data-action="add-gps">
                        <i class="fas fa-plus-circle">‚ûï</i>
                        Add GPS Coordinates
                    </button>
                </div>
                {% endif %}
            </div>

            <!-- Complete EXIF Data Section -->
            <div class="result exif-data-section">
                <h2 class="result-title">
                    <i class="fas fa-info-circle">üìä</i>
                    Complete EXIF Metadata
                </h2>
                
                <div class="exif-tabs">
                    <button class="exif-tab active" onclick="switchExifTab('camera')">Camera</button>
                    <button class="exif-tab" onclick="switchExifTab('image')">Image</button>
                    <button class="exif-tab" onclick="switchExifTab('datetime')">Date/Time</button>
                    <button class="exif-tab" onclick="switchExifTab('gps')">GPS</button>
                    <button class="exif-tab" onclick="switchExifTab('other')">Other</button>
                </div>
                
                <div class="exif-content">
                    <!-- Camera Tab -->
                    <div id="camera-tab" class="exif-tab-content active">
                        <h3>Camera Information</h3>
                        <div class="exif-grid">
                            {% if exif_data.camera %}
                                {% for key, value in exif_data.camera.items() %}
                                <div class="exif-item">
                                    <span class="exif-label">{{ key }}:</span>
                                    <span class="exif-value">{{ value }}</span>
                                </div>
                                {% endfor %}
                            {% else %}
                                <p class="no-data">No camera data available</p>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Image Tab -->
                    <div id="image-tab" class="exif-tab-content">
                        <h3>Image Properties</h3>
                        <div class="exif-grid">
                            {% if exif_data.image %}
                                {% for key, value in exif_data.image.items() %}
                                <div class="exif-item">
                                    <span class="exif-label">{{ key }}:</span>
                                    <span class="exif-value">
                                        {% if key == 'file_size' %}
                                            {{ (value / 1024 / 1024) | round(2) }} MB
                                        {% elif key == 'width' or key == 'height' %}
                                            {{ value }}px
                                        {% else %}
                                            {{ value }}
                                        {% endif %}
                                    </span>
                                </div>
                                {% endfor %}
                            {% else %}
                                <p class="no-data">No image data available</p>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- DateTime Tab -->
                    <div id="datetime-tab" class="exif-tab-content">
                        <h3>Date & Time Information</h3>
                        <div class="exif-grid">
                            {% if exif_data.datetime %}
                                {% for key, value in exif_data.datetime.items() %}
                                <div class="exif-item">
                                    <span class="exif-label">{{ key }}:</span>
                                    <span class="exif-value">{{ value }}</span>
                                </div>
                                {% endfor %}
                            {% else %}
                                <p class="no-data">No date/time data available</p>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- GPS Tab -->
                    <div id="gps-tab" class="exif-tab-content">
                        <h3>GPS Information</h3>
                        <div class="exif-grid">
                            {% if exif_data.gps %}
                                {% for key, value in exif_data.gps.items() %}
                                <div class="exif-item">
                                    <span class="exif-label">{{ key }}:</span>
                                    <span class="exif-value">{{ value }}</span>
                                </div>
                                {% endfor %}
                            {% else %}
                                <p class="no-data">No GPS data available</p>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Other Tab -->
                    <div id="other-tab" class="exif-tab-content">
                        <h3>Additional Metadata</h3>
                        <div class="exif-grid">
                            {% if exif_data.other %}
                                {% for key, value in exif_data.other.items() %}
                                <div class="exif-item">
                                    <span class="exif-label">{{ key }}:</span>
                                    <span class="exif-value">{{ value | truncate(50) }}</span>
                                </div>
                                {% endfor %}
                            {% else %}
                                <p class="no-data">No additional metadata available</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            {% if not success and not error %}
            <div class="welcome-message">
                <h2>
                    <i class="fas fa-info-circle">‚ÑπÔ∏è</i>
                    How to Use GeoPhoto Enhanced
                </h2>
                <div class="info-grid">
                    <div class="info-card">
                        <i class="fas fa-camera">üì∏</i>
                        <h3>Take a Photo</h3>
                        <p>Use your phone's camera with GPS enabled to capture location data</p>
                    </div>
                    <div class="info-card">
                        <i class="fas fa-upload">‚¨ÜÔ∏è</i>
                        <h3>Upload Here</h3>
                        <p>Drag and drop or click to select your photo file</p>
                    </div>
                    <div class="info-card">
                        <i class="fas fa-map-marked-alt">üìç</i>
                        <h3>Get Full Analysis</h3>
                        <p>Receive complete EXIF metadata including GPS, camera settings, and more</p>
                    </div>
                </div>
            </div>
            {% endif %}
        </section>
    </main>

    <!-- GPS Edit/Add Modal -->
    <div id="gps-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeGPSModal()">&times;</span>
            <h2 id="modal-title">Edit GPS Coordinates</h2>
            
            <div class="modal-body">
                <div class="coordinate-input-group">
                    <label for="latitude-input">Latitude:</label>
                    <input type="number" id="latitude-input" step="0.000001" min="-90" max="90" placeholder="-90 to 90">
                    <small>Valid range: -90 to 90</small>
                </div>
                
                <div class="coordinate-input-group">
                    <label for="longitude-input">Longitude:</label>
                    <input type="number" id="longitude-input" step="0.000001" min="-180" max="180" placeholder="-180 to 180">
                    <small>Valid range: -180 to 180</small>
                </div>
                
                <div class="coordinate-format-help">
                    <h4>Coordinate Format Examples:</h4>
                    <ul>
                        <li>New York: 40.7128, -74.0060</li>
                        <li>London: 51.5074, -0.1278</li>
                        <li>Tokyo: 35.6762, 139.6503</li>
                    </ul>
                </div>
                
                <div class="modal-actions">
                    <button class="modal-btn cancel" onclick="closeGPSModal()">Cancel</button>
                    <button class="modal-btn save" onclick="saveGPSCoordinates()">Save & Download</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Store image data for GPS editing -->
    {% if temp_image %}
    <script>
        window.tempImageData = "{{ temp_image }}";
        window.currentFilename = "{{ filename }}";
    </script>
    {% endif %}

    <footer class="footer">
        <p>
            <i class="fas fa-shield-alt">üîí</i>
            Please be aware of the privacy implications of sharing photos with embedded location data.
        </p>
        <p style="margin-top: 1rem; font-size: 0.9rem; opacity: 0.8;">
            <i class="fas fa-star">‚≠ê</i>
            Enhanced with complete EXIF extraction and GPS editing capabilities
        </p>
    </footer>
</div>
{% endblock %}